<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>西藏之旅</title>
    <style type="text/css">
        html{height:100%}
        body{height:100%;margin:0px;padding:0px}
        #container{width:100%;height:100%;}
    </style>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=1.0&type=webgl&ak=dqQDIGUBKkxcLpKWgTOFHpjt"></script>
    <script type="text/javascript" src="lushu.js?a=5"></script>
    <script type="text/javascript" src="common.js?b=5"></script>
    <!--<script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>-->
    <style type="text/css">
        /*.BMap_bubble_pop{
            border-radius: 25px;
        }*/
    </style>
</head>

<body>
<!--<select id="day_select">
    <option value = "1">第1天</option>
    <option value = "2">第2天</option>
    <option value = "3">第3天</option>
    <option value = "4">第4天</option>
    <option value = "5">第5天</option>
    <option value = "6">第6天</option>
    <option value = "7">第7天</option>
    <option value = "8">第8天</option>
    <option value = "9">第9天</option>
    <option value = "10">全程</option>
</select>-->
<!--
<iframe src="http://raoql.top" width="200" height="200">

</iframe>
-->


<div id="container">

</div>



<script type="text/javascript">




    var map = new BMapGL.Map("container");
    // 创建地图实例
    var point = new BMapGL.Point(113.314282,23.395352);
    // 创建点坐标
    map.centerAndZoom(point, 4);
    // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放

    //map.setHeading(64.5);   //设置地图旋转角度
    //map.setTilt(45);       //设置地图的倾斜角度
    map.setMapType(BMAP_EARTH_MAP);      // 设置地图类型为地球模式

    var scaleCtrl = new BMapGL.ScaleControl();  // 添加比例尺控件
    map.addControl(scaleCtrl);
    var zoomCtrl = new BMapGL.ZoomControl();  // 添加缩放控件
    //map.addControl(zoomCtrl);

    var opts_baiyun = {
        width: 300,     // 信息窗口宽度
        height: 0,    // 信息窗口高度
        title: "Day1(10-04)：广州白云国际机场"  // 信息窗口标题
    };
    var infoWindow_baiyun = new BMapGL.InfoWindow("广州白云国际机场，位于中国广东省广州市白云区人和镇和花都区新华街道、花东镇交界处，距广州市中心约28公里，为4F级民用国际机场，是中国三大门户复合枢纽机场之一，世界前五十位主要机场。", opts_baiyun);  // 创建信息窗口对象
    var point_baiyun= new BMapGL.Point(113.314282,23.395352);
    var icon_jichang = new BMapGL.Icon(cat, new BMapGL.Size(24, 24), { anchor: new BMapGL.Size(24, 24) });
    var marker_baiyun = new BMapGL.Marker(point_baiyun,{
        icon: icon_jichang,
        title: "广州白云机场",
    });
    /*map.addOverlay(marker_baiyun);                     // 将标注添加到地图中

    marker_baiyun.addEventListener("click", function(){
        map.openInfoWindow(infoWindow_baiyun, point_baiyun);        // 打开信息窗口
    });*/



    /*返回点击的坐标信息*/
    function showInfo(e){
        alert(e.latlng.lng + ", " + e.latlng.lat);
    }
    //map.addEventListener("click", showInfo);

    var lushu = route(fly, 1000000, {"begin_lng": 113.314282, "begin_lat": 23.395352, "end_lng": 90.918706, "end_lat": 29.299495}, '#000000', 1, "第1天：坐飞机前往西藏", false, [{lng:90.918706,lat:29.299495,html:'(day1)拉萨贡嘎国际机场',pauseTime:3}]);

    function startLushu() {

        //路书启动,参数为一个函数
        lushu.start(function() {
            centerAndZoomSlow(90.918706,29.299495, 12);
            lushu = null; //当前路书置空
            setTimeout('startLushu2()', 1000);

        });
    }


    //var routeDrive2 = routeDrive(car, 30000, '#000000', 2, "第1天：前往拉萨市区", true, [{lng:91.141549,lat:29.652559,html:'(day1)到达：拉萨市城关区',pauseTime:2},{lng:91.140988,lat:29.652539,html:'(day1)到达：拉萨市城关区',pauseTime:2}]);

    /*var drv2 = routeDrive('#000000', 2, true);
    routeDriveSearch(drv2.route_drv,{"begin_lng": 90.918706, "begin_lat": 29.299495, "end_lng": 91.140031, "end_lat": 29.653516});
*/




    function startLushu2() {

        var lushu2 = routeDrive(car, 30000, {"begin_lng": 90.918706, "begin_lat": 29.299495, "end_lng": 91.140031, "end_lat": 29.653516}, '#000000', 2, "第1天：前往拉萨市区", true, [{lng:91.141549,lat:29.652559,html:'(day1)到达：拉萨市城关区',pauseTime:2},{lng:91.140988,lat:29.652539,html:'(day1)到达：拉萨市城关区',pauseTime:2}]);

        //路书启动,参数为一个函数
        lushu2.start(function() {
            centerAndZoomSlow(91.141549,29.652559, 15);

            setTimeout('startLushu3()', 1000);
        });



    }

    var lushu3 = route(ufo, 150, {"begin_lng": 91.140422, "begin_lat": 29.652606, "end_lng": 91.140031, "end_lat": 29.653516}, '#000000', 3, "第1天：前往住宿地点", true, [{lng:91.140031,lat:29.653516,html:'(day1)拉萨风火水土藏式生活民宿',pauseTime:1}]);


    function startLushu3() {
        setTimeout('centerAndZoomSlow(91.140031,29.653516, 18)', 1000);
        lushu3.start(function() {
            lushu2.removeMark();
            setTimeout('startLushu4()', 1000);
        });
    }


    //第二天
    var lushu4; //米拉山口
    // 实例化一个驾车导航用来生成路线
    var drv4 = new BMapGL.DrivingRoute('西藏', {
        onSearchComplete: function(res4) {
            if (drv4.getStatus() == BMAP_STATUS_SUCCESS) {
                var plan4 = res4.getPlan(0);
                var arrPois4 =[];
                for(var j4=0;j4<plan4.getNumRoutes();j4++){
                    var route4 = plan4.getRoute(j4);
                    arrPois4= arrPois4.concat(route4.getPath());
                }
                map.addOverlay(new BMapGL.Polyline(arrPois4, {strokeColor: '#FF8C00','strokeWeight': 3}));
                map.setViewport(arrPois4);

                lushu4 = new BMapGLLib.LuShu(map,arrPois4,{
                    defaultContent:"第2天：前往米拉山口",
                    autoView:true,//是否开启自动视野调整，如果开启那么路书在运动过程中会根据视野自动调整
                    icon  : new BMapGL.Icon(car, new BMapGL.Size(30,30),{anchor : new BMapGL.Size(24, 24)}),
                    speed: 60000,
                    enableRotation:true,//是否设置marker随着道路的走向进行旋转
                    landmarkPois: [
                        {lng:92.352021,lat:29.830096,html:'(day2)到达：米拉山口',pauseTime:1},
                        {lng:92.368047,lat:29.828266,html:'(day2)到达：米拉山口',pauseTime:1},
                        {lng:92.36998200946425,lat:29.82764890641419,html:'(day2)到达：米拉山口',pauseTime:1},
                        {lng:92.372929,lat:29.826029,html:'(day2)到达：米拉山口',pauseTime:1},
                    ]});

                centerAndZoomSlow(91.140031,29.653516, 10);
                //路书启动,参数为一个函数
                lushu4.start(function() {
                    centerAndZoomSlow(92.351931,29.830882, 14);
                    startLushu5();
                });

            }
        }
    });

    function startLushu4() {


        var start4=new BMapGL.Point(91.140031,29.653516);
        var end4=new BMapGL.Point(92.351931,29.830882);
        drv4.search(start4, end4);





    }

    var lushu5; //尼洋河
    // 实例化一个驾车导航用来生成路线
    var drv5 = new BMapGL.DrivingRoute('西藏', {
        onSearchComplete: function(res5) {
            if (drv5.getStatus() == BMAP_STATUS_SUCCESS) {
                var plan5 = res5.getPlan(0);
                var arrPois5 =[];
                for(var j5=0;j5<plan5.getNumRoutes();j5++){
                    var route5 = plan5.getRoute(j5);
                    arrPois5= arrPois5.concat(route5.getPath());
                }
                map.addOverlay(new BMapGL.Polyline(arrPois5, {strokeColor: '#FF8C00','strokeWeight': 3}));
                map.setViewport(arrPois5);

                lushu5 = new BMapGLLib.LuShu(map,arrPois5,{
                    defaultContent:"第2天：前往尼洋河",
                    autoView:true,//是否开启自动视野调整，如果开启那么路书在运动过程中会根据视野自动调整
                    icon  : new BMapGL.Icon(car, new BMapGL.Size(30,30),{anchor : new BMapGL.Size(24, 24)}),
                    speed: 30000,
                    enableRotation:true,//是否设置marker随着道路的走向进行旋转
                    landmarkPois: [
                        {lng:93.06344020127541,lat:30.00001073050791,html:'(day2)到达：尼洋河（就是左边那条河）',pauseTime:1},
                    ]});

                centerAndZoomSlow(92.351931,29.830882, 10);
                //路书启动,参数为一个函数
                lushu5.start(function() {
                    centerAndZoomSlow(93.094412,29.999537, 13);
                    startLushu6();
                });

            }
        }
    });

    function startLushu5() {


        var start5=new BMapGL.Point(92.351931,29.830882);
        var end5=new BMapGL.Point(93.094412,29.999537);
        drv5.search(start5, end5);

        lushu4.removeMark();





    }





    /*脚本开始*/
    //centerAndZoomSlow(91.140031,29.653516, 14);  //一定要拉近镜头 不然汽车跑不动
    setTimeout('startLushu()', 1000);
    /*var day = $("#day_select").find("option:selected").val();

    $('#day_select').change(function(){
        day = $("#day_select").find("option:selected").val();
        var point_new = new BMapGL.Point(113.314282,23.395352);
        map.centerAndZoom(point_new, 5);
        //脚本开始
        if(day == 2){
            //移除覆盖物
            map.removeOverlay(cat);
            map.removeOverlay(car);
            map.removeOverlay(ufo);
            map.removeOverlay(fly);
            map.removeOverlay(polyline);
            startLushu();
        }
    });*/




</script>
</body>
</html>